{% extends "base.html" %}

{% block title %}Advanced Analytics - PerformancePro{% endblock %}

{% block content %}
<!-- Analytics Header -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card-enterprise">
            <div class="card-header-enterprise">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h3 class="mb-1">Advanced Performance Analytics</h3>
                        <p class="mb-0 opacity-90">Comprehensive insights and predictive analytics for strategic decision making</p>
                    </div>
                    <div class="d-flex align-items-center gap-2">
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-light active" onclick="setTimeframe('thisMonth')">This Month</button>
                            <button class="btn btn-outline-light" onclick="setTimeframe('lastMonth')">Last Month</button>
                            <button class="btn btn-outline-light" onclick="setTimeframe('quarter')">This Quarter</button>
                            <button class="btn btn-outline-light" onclick="setTimeframe('year')">This Year</button>
                        </div>
                        <button class="btn btn-success-enterprise btn-sm" onclick="exportAnalytics()">
                            <i class="fas fa-download me-1"></i>Export Report
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Executive KPIs -->
<div class="row mb-4">
    <div class="col-xl-2 col-lg-4 col-md-6 mb-3">
        <div class="metric-card">
            <div class="metric-value text-primary">94.7%</div>
            <div class="metric-label">Overall Efficiency</div>
            <div class="metric-change text-success">
                <i class="fas fa-arrow-up me-1"></i>+2.3% vs target
            </div>
        </div>
    </div>
    <div class="col-xl-2 col-lg-4 col-md-6 mb-3">
        <div class="metric-card">
            <div class="metric-value text-success">8.7</div>
            <div class="metric-label">Avg Points/Employee</div>
            <div class="metric-change text-success">
                <i class="fas fa-arrow-up me-1"></i>+1.2 pts improvement
            </div>
        </div>
    </div>
    <div class="col-xl-2 col-lg-4 col-md-6 mb-3">
        <div class="metric-card">
            <div class="metric-value text-info">â‚¹2.8L</div>
            <div class="metric-label">Total Bonus Payout</div>
            <div class="metric-change text-info">
                <i class="fas fa-chart-line me-1"></i>18.5% of payroll
            </div>
        </div>
    </div>
    <div class="col-xl-2 col-lg-4 col-md-6 mb-3">
        <div class="metric-card">
            <div class="metric-value text-warning">97.2%</div>
            <div class="metric-label">Goal Achievement</div>
            <div class="metric-change text-success">
                <i class="fas fa-target me-1"></i>Above benchmark
            </div>
        </div>
    </div>
    <div class="col-xl-2 col-lg-4 col-md-6 mb-3">
        <div class="metric-card">
            <div class="metric-value text-danger">2.1%</div>
            <div class="metric-label">Task Failure Rate</div>
            <div class="metric-change text-success">
                <i class="fas fa-arrow-down me-1"></i>-0.8% improvement
            </div>
        </div>
    </div>
    <div class="col-xl-2 col-lg-4 col-md-6 mb-3">
        <div class="metric-card">
            <div class="metric-value text-purple">12.3</div>
            <div class="metric-label">ROI Multiplier</div>
            <div class="metric-change text-success">
                <i class="fas fa-rocket me-1"></i>Exceptional performance
            </div>
        </div>
    </div>
</div>

<!-- Main Analytics Grid -->
<div class="row">
    <!-- Performance Trends -->
    <div class="col-xl-8 col-lg-7 mb-4">
        <div class="card-enterprise">
            <div class="card-header-enterprise">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-area me-2"></i>Performance Trends & Forecasting
                    </h5>
                    <div class="btn-group btn-group-sm">
                        <button class="btn btn-outline-light active" onclick="showChart('performance')">Performance</button>
                        <button class="btn btn-outline-light" onclick="showChart('efficiency')">Efficiency</button>
                        <button class="btn btn-outline-light" onclick="showChart('bonus')">Bonus Payout</button>
                        <button class="btn btn-outline-light" onclick="showChart('prediction')">Forecast</button>
                    </div>
                </div>
            </div>
            <div class="card-body-enterprise">
                <canvas id="trendsChart" height="120"></canvas>
            </div>
        </div>
    </div>
    
    <!-- Department Analytics -->
    <div class="col-xl-4 col-lg-5 mb-4">
        <div class="card-enterprise">
            <div class="card-header-enterprise">
                <h5 class="mb-0">
                    <i class="fas fa-building me-2"></i>Department Performance Matrix
                </h5>
            </div>
            <div class="card-body-enterprise">
                <canvas id="departmentMatrix" height="200"></canvas>
                
                <div class="mt-4">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="fw-medium">Engineering</span>
                        <div class="d-flex align-items-center">
                            <div class="progress me-2" style="width: 60px; height: 6px;">
                                <div class="progress-bar bg-success" style="width: 95%"></div>
                            </div>
                            <span class="text-success fw-semibold">A+</span>
                        </div>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="fw-medium">Product</span>
                        <div class="d-flex align-items-center">
                            <div class="progress me-2" style="width: 60px; height: 6px;">
                                <div class="progress-bar bg-primary" style="width: 88%"></div>
                            </div>
                            <span class="text-primary fw-semibold">A</span>
                        </div>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="fw-medium">Sales</span>
                        <div class="d-flex align-items-center">
                            <div class="progress me-2" style="width: 60px; height: 6px;">
                                <div class="progress-bar bg-info" style="width: 78%"></div>
                            </div>
                            <span class="text-info fw-semibold">B+</span>
                        </div>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="fw-medium">Operations</span>
                        <div class="d-flex align-items-center">
                            <div class="progress me-2" style="width: 60px; height: 6px;">
                                <div class="progress-bar bg-warning" style="width: 72%"></div>
                            </div>
                            <span class="text-warning fw-semibold">B</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Advanced Analytics Row -->
<div class="row">
    <!-- Productivity Heatmap -->
    <div class="col-xl-6 col-lg-6 mb-4">
        <div class="card-enterprise">
            <div class="card-header-enterprise">
                <h5 class="mb-0">
                    <i class="fas fa-fire me-2"></i>Productivity Heatmap
                </h5>
            </div>
            <div class="card-body-enterprise">
                <div class="mb-3">
                    <small class="text-muted">Performance intensity by day and time</small>
                </div>
                
                <!-- Heatmap Calendar -->
                <div class="heatmap-calendar">
                    <div class="row text-center mb-2">
                        <div class="col"><small class="text-muted">Mon</small></div>
                        <div class="col"><small class="text-muted">Tue</small></div>
                        <div class="col"><small class="text-muted">Wed</small></div>
                        <div class="col"><small class="text-muted">Thu</small></div>
                        <div class="col"><small class="text-muted">Fri</small></div>
                        <div class="col"><small class="text-muted">Sat</small></div>
                    </div>
                    
                    <!-- Week rows -->
                    <div class="row mb-1">
                        <div class="col"><div class="heatmap-cell intensity-high" data-bs-toggle="tooltip" title="9.2 avg points"></div></div>
                        <div class="col"><div class="heatmap-cell intensity-high" data-bs-toggle="tooltip" title="8.8 avg points"></div></div>
                        <div class="col"><div class="heatmap-cell intensity-medium" data-bs-toggle="tooltip" title="7.5 avg points"></div></div>
                        <div class="col"><div class="heatmap-cell intensity-high" data-bs-toggle="tooltip" title="9.1 avg points"></div></div>
                        <div class="col"><div class="heatmap-cell intensity-low" data-bs-toggle="tooltip" title="6.2 avg points"></div></div>
                        <div class="col"><div class="heatmap-cell intensity-medium" data-bs-toggle="tooltip" title="7.8 avg points"></div></div>
                    </div>
                    <div class="row mb-1">
                        <div class="col"><div class="heatmap-cell intensity-medium" data-bs-toggle="tooltip" title="8.1 avg points"></div></div>
                        <div class="col"><div class="heatmap-cell intensity-high" data-bs-toggle="tooltip" title="9.5 avg points"></div></div>
                        <div class="col"><div class="heatmap-cell intensity-high" data-bs-toggle="tooltip" title="8.9 avg points"></div></div>
                        <div class="col"><div class="heatmap-cell intensity-medium" data-bs-toggle="tooltip" title="7.3 avg points"></div></div>
                        <div class="col"><div class="heatmap-cell intensity-high" data-bs-toggle="tooltip" title="9.0 avg points"></div></div>
                        <div class="col"><div class="heatmap-cell intensity-medium" data-bs-toggle="tooltip" title="8.0 avg points"></div></div>
                    </div>
                    <div class="row mb-1">
                        <div class="col"><div class="heatmap-cell intensity-high" data-bs-toggle="tooltip" title="9.3 avg points"></div></div>
                        <div class="col"><div class="heatmap-cell intensity-medium" data-bs-toggle="tooltip" title="7.7 avg points"></div></div>
                        <div class="col"><div class="heatmap-cell intensity-high" data-bs-toggle="tooltip" title="8.6 avg points"></div></div>
                        <div class="col"><div class="heatmap-cell intensity-high" data-bs-toggle="tooltip" title="9.4 avg points"></div></div>
                        <div class="col"><div class="heatmap-cell intensity-medium" data-bs-toggle="tooltip" title="7.9 avg points"></div></div>
                        <div class="col"><div class="heatmap-cell intensity-low" data-bs-toggle="tooltip" title="5.8 avg points"></div></div>
                    </div>
                    <div class="row">
                        <div class="col"><div class="heatmap-cell intensity-high" data-bs-toggle="tooltip" title="8.7 avg points"></div></div>
                        <div class="col"><div class="heatmap-cell intensity-high" data-bs-toggle="tooltip" title="9.1 avg points"></div></div>
                        <div class="col"><div class="heatmap-cell intensity-medium" data-bs-toggle="tooltip" title="8.2 avg points"></div></div>
                        <div class="col"><div class="heatmap-cell intensity-high" data-bs-toggle="tooltip" title="8.8 avg points"></div></div>
                        <div class="col"><div class="heatmap-cell intensity-medium" data-bs-toggle="tooltip" title="7.6 avg points"></div></div>
                        <div class="col"><div class="heatmap-cell intensity-medium" data-bs-toggle="tooltip" title="8.3 avg points"></div></div>
                    </div>
                </div>
                
                <div class="d-flex justify-content-between align-items-center mt-3">
                    <small class="text-muted">
                        <span class="heatmap-legend intensity-low"></span> Low
                        <span class="heatmap-legend intensity-medium ms-2"></span> Medium
                        <span class="heatmap-legend intensity-high ms-2"></span> High
                    </small>
                    <small class="text-muted">Performance Intensity</small>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Employee Performance Distribution -->
    <div class="col-xl-6 col-lg-6 mb-4">
        <div class="card-enterprise">
            <div class="card-header-enterprise">
                <h5 class="mb-0">
                    <i class="fas fa-users me-2"></i>Performance Distribution Analysis
                </h5>
            </div>
            <div class="card-body-enterprise">
                <canvas id="distributionChart" height="200"></canvas>
                
                <div class="row mt-4 text-center">
                    <div class="col-3">
                        <div class="fw-bold text-success">23%</div>
                        <small class="text-muted">Top Performers</small>
                    </div>
                    <div class="col-3">
                        <div class="fw-bold text-primary">51%</div>
                        <small class="text-muted">High Performers</small>
                    </div>
                    <div class="col-3">
                        <div class="fw-bold text-warning">19%</div>
                        <small class="text-muted">Average</small>
                    </div>
                    <div class="col-3">
                        <div class="fw-bold text-danger">7%</div>
                        <small class="text-muted">Needs Support</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Insights and Recommendations -->
<div class="row">
    <div class="col-xl-8 col-lg-7 mb-4">
        <div class="card-enterprise">
            <div class="card-header-enterprise">
                <h5 class="mb-0">
                    <i class="fas fa-brain me-2"></i>AI-Powered Insights & Recommendations
                </h5>
            </div>
            <div class="card-body-enterprise">
                <div class="row">
                    <div class="col-md-6">
                        <div class="insight-card mb-3">
                            <div class="d-flex align-items-start">
                                <div class="insight-icon bg-success text-white">
                                    <i class="fas fa-arrow-trend-up"></i>
                                </div>
                                <div class="ms-3">
                                    <h6 class="mb-1 text-success">Performance Trend</h6>
                                    <p class="mb-1 text-muted">
                                        Overall team productivity has increased by 15.3% this month. 
                                        Engineering team leading with 23% improvement.
                                    </p>
                                    <small class="text-success fw-semibold">
                                        <i class="fas fa-lightbulb me-1"></i>
                                        Recommendation: Recognize high performers publicly
                                    </small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="insight-card mb-3">
                            <div class="d-flex align-items-start">
                                <div class="insight-icon bg-warning text-white">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <div class="ms-3">
                                    <h6 class="mb-1 text-warning">Quality Alert</h6>
                                    <p class="mb-1 text-muted">
                                        Task failure rate increased by 0.3% in Sales department. 
                                        Root cause analysis suggests training gap.
                                    </p>
                                    <small class="text-warning fw-semibold">
                                        <i class="fas fa-lightbulb me-1"></i>
                                        Action: Schedule skills training workshop
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="insight-card mb-3">
                            <div class="d-flex align-items-start">
                                <div class="insight-icon bg-info text-white">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div class="ms-3">
                                    <h6 class="mb-1 text-info">Efficiency Opportunity</h6>
                                    <p class="mb-1 text-muted">
                                        Tuesday and Wednesday show 12% higher efficiency. 
                                        Consider scheduling critical tasks on these days.
                                    </p>
                                    <small class="text-info fw-semibold">
                                        <i class="fas fa-lightbulb me-1"></i>
                                        Optimize: Reschedule weekly planning to Monday
                                    </small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="insight-card mb-3">
                            <div class="d-flex align-items-start">
                                <div class="insight-icon bg-primary text-white">
                                    <i class="fas fa-money-bill-trend-up"></i>
                                </div>
                                <div class="ms-3">
                                    <h6 class="mb-1 text-primary">Bonus Impact</h6>
                                    <p class="mb-1 text-muted">
                                        Current trajectory suggests 92% of employees will achieve 
                                        above-average bonuses this month.
                                    </p>
                                    <small class="text-primary fw-semibold">
                                        <i class="fas fa-lightbulb me-1"></i>
                                        Forecast: â‚¹3.2L total bonus payout expected
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Predictive Analytics -->
    <div class="col-xl-4 col-lg-5 mb-4">
        <div class="card-enterprise">
            <div class="card-header-enterprise">
                <h5 class="mb-0">
                    <i class="fas fa-crystal-ball me-2"></i>Predictive Analytics
                </h5>
            </div>
            <div class="card-body-enterprise">
                <div class="metric-card border-0 mb-3" style="background: linear-gradient(135deg, #f0f9ff, #e0f2fe);">
                    <div class="metric-value text-primary">â‚¹3.2L</div>
                    <div class="metric-label">Predicted Month-End Bonus</div>
                    <div class="metric-change text-success">
                        <i class="fas fa-trend-up me-1"></i>+14% vs last month
                    </div>
                </div>
                
                <div class="metric-card border-0 mb-3" style="background: linear-gradient(135deg, #f0fdf4, #dcfce7);">
                    <div class="metric-value text-success">96.2%</div>
                    <div class="metric-label">Projected Efficiency</div>
                    <div class="metric-change text-success">
                        <i class="fas fa-target me-1"></i>Above target zone
                    </div>
                </div>
                
                <div class="metric-card border-0 mb-3" style="background: linear-gradient(135deg, #fefbf3, #fef3c7);">
                    <div class="metric-value text-warning">3</div>
                    <div class="metric-label">At-Risk Employees</div>
                    <div class="metric-change text-warning">
                        <i class="fas fa-user-shield me-1"></i>Intervention needed
                    </div>
                </div>
                
                <div class="alert alert-primary border-0 mt-3" style="background: #f0f9ff;">
                    <small>
                        <i class="fas fa-robot me-1"></i>
                        <strong>AI Confidence:</strong> 94.7% accuracy based on historical patterns
                    </small>
                </div>
                
                <div class="d-grid">
                    <button class="btn btn-outline-primary btn-sm" onclick="viewDetailedForecast()">
                        <i class="fas fa-chart-line me-1"></i>View Detailed Forecast
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .insight-card {
        background: #f8f9fa;
        border-radius: 0.75rem;
        padding: 1.25rem;
        border-left: 4px solid var(--primary-blue);
    }
    
    .insight-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.1rem;
    }
    
    .heatmap-calendar {
        font-size: 0.8rem;
    }
    
    .heatmap-cell {
        aspect-ratio: 1;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .heatmap-cell:hover {
        transform: scale(1.1);
        z-index: 10;
        position: relative;
    }
    
    .intensity-low {
        background: #e2e8f0;
    }
    
    .intensity-medium {
        background: #93c5fd;
    }
    
    .intensity-high {
        background: #3b82f6;
    }
    
    .heatmap-legend {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 2px;
    }
    
    .text-purple {
        color: #8b5cf6 !important;
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    let trendsChart, departmentMatrix, distributionChart;
    
    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
        initializeCharts();
        
        // Initialize tooltips
        const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
    });
    
    function initializeCharts() {
        initTrendsChart();
        initDepartmentMatrix();
        initDistributionChart();
    }
    
    function initTrendsChart() {
        const ctx = document.getElementById('trendsChart').getContext('2d');
        
        // Fetch real performance trends
        fetch('/api/dashboard_metrics')
            .then(response => response.json())
            .then(apiData => {
                const data = {
                    labels: apiData.trends.labels,
                    datasets: [{
                        label: 'Team Performance',
                        data: apiData.trends.points,
                        borderColor: 'rgb(59, 130, 246)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'Efficiency Target',
                        data: new Array(apiData.trends.labels.length).fill(9),
                        borderColor: 'rgb(16, 185, 129)',
                        borderDash: [5, 5],
                        borderWidth: 2,
                        fill: false
                    }, {
                        label: 'Industry Benchmark',
                        data: new Array(apiData.trends.labels.length).fill(7.5),
                        borderColor: 'rgb(156, 163, 175)',
                        borderDash: [3, 3],
                        borderWidth: 1,
                        fill: false
                    }]
                };
                
                trendsChart = new Chart(ctx, {
                    type: 'line',
                    data: data,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    font: { family: 'Inter' }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 12,
                                grid: { color: 'rgba(0,0,0,0.05)' }
                            },
                            x: {
                                grid: { color: 'rgba(0,0,0,0.05)' }
                            }
                        }
                    }
                });
            })
            .catch(error => {
                console.error('Error loading trends data:', error);
                // Fallback to demo data
                const data = {
                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5 (Projected)'],
                    datasets: [{
                        label: 'Team Performance',
                        data: [8.2, 8.5, 8.9, 9.1, 9.3],
                        borderColor: 'rgb(59, 130, 246)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                };
                
                trendsChart = new Chart(ctx, {
                    type: 'line',
                    data: data,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    font: { family: 'Inter' }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 12,
                                grid: { color: 'rgba(0,0,0,0.05)' }
                            },
                            x: {
                                grid: { color: 'rgba(0,0,0,0.05)' }
                            }
                        }
                    }
                });
            });
    }
    
    function initDepartmentMatrix() {
        const ctx = document.getElementById('departmentMatrix').getContext('2d');
        
        const data = {
            labels: ['Engineering', 'Product', 'Sales', 'Marketing', 'Operations'],
            datasets: [{
                data: [42, 28, 15, 10, 5],
                backgroundColor: [
                    'rgb(59, 130, 246)',
                    'rgb(16, 185, 129)',
                    'rgb(245, 158, 11)',
                    'rgb(239, 68, 68)',
                    'rgb(139, 92, 246)'
                ],
                borderWidth: 0
            }]
        };
        
        departmentMatrix = new Chart(ctx, {
            type: 'doughnut',
            data: data,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                }
            }
        });
    }
    
    function initDistributionChart() {
        const ctx = document.getElementById('distributionChart').getContext('2d');
        
        // Fetch real performance distribution data
        fetch('/api/performance_distribution')
            .then(response => response.json())
            .then(apiData => {
                distributionChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: apiData.labels,
                        datasets: [{
                            data: apiData.data,
                            backgroundColor: apiData.colors,
                            borderWidth: 2,
                            borderColor: 'white'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            })
            .catch(error => {
                console.error('Error loading distribution data:', error);
                // Fallback to demo data
                const data = {
                    labels: ['Top Performers', 'High Performers', 'Average', 'Needs Support'],
                    datasets: [{
                        data: [23, 51, 19, 7],
                        backgroundColor: [
                            'rgb(16, 185, 129)',
                            'rgb(59, 130, 246)',
                            'rgb(245, 158, 11)',
                            'rgb(239, 68, 68)'
                        ],
                        borderWidth: 2,
                        borderColor: 'white'
                    }]
                };
                
                distributionChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: data,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            });
    }
    
    // Chart switching functions
    function showChart(type) {
        // Update active button
        document.querySelectorAll('.btn-group .btn').forEach(btn => {
            btn.classList.remove('active');
        });
        event.target.classList.add('active');
        
        // Update chart data based on type
        switch(type) {
            case 'efficiency':
                trendsChart.data.datasets[0].data = [94, 96, 97, 95, 98];
                trendsChart.data.datasets[0].label = 'Team Efficiency %';
                break;
            case 'bonus':
                trendsChart.data.datasets[0].data = [2.1, 2.3, 2.6, 2.8, 3.2];
                trendsChart.data.datasets[0].label = 'Bonus Payout (â‚¹L)';
                break;
            case 'prediction':
                trendsChart.data.datasets[0].data = [8.2, 8.5, 8.9, 9.1, 9.5];
                trendsChart.data.datasets[0].label = 'Predicted Performance';
                break;
            default:
                trendsChart.data.datasets[0].data = [8.2, 8.5, 8.9, 9.1, 9.3];
                trendsChart.data.datasets[0].label = 'Team Performance';
        }
        
        trendsChart.update();
    }
    
    function setTimeframe(period) {
        // Update active button
        document.querySelectorAll('.btn-group .btn').forEach(btn => {
            btn.classList.remove('active');
        });
        event.target.classList.add('active');
        
        PerformancePro.showSuccess(`Analytics updated for ${period}`);
        // In real app, would fetch data for the selected timeframe
    }
    
    function exportAnalytics() {
        PerformancePro.showSuccess('Generating comprehensive analytics report...');
        // Simulate report generation
        setTimeout(() => {
            PerformancePro.showSuccess('Analytics report exported successfully');
        }, 2000);
    }
    
    function viewDetailedForecast() {
        PerformancePro.showSuccess('Opening detailed predictive analytics dashboard...');
    }
</script>
{% endblock %}
